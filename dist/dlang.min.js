const fs=require("fs"),createId=e=>btoa(e);class DLang{constructor(e){this.lines=e.split("\n")}noHandler(){}run(){let e=this.lines,n=!1,r=!1,s={};for(let t=0;t<e.length;t++){if("import 'dl:main/base.dlang'"===e[t]&&(n=!0),"import 'dl:main/database.dlang'"===e[t]&&(r=!0),e[t].includes("(")){let l,i=e[t].split("(")[0],o=e[t].replace("(","").replace(")","").replace(i,"");l=o.includes("'")?o.replace(/\'/g,""):s[o];let a="createUnsafeDB"===i&&!0===r,c="createDocument"===i&&!0===r,f="createProperty"===i&&!0===r,d="removeDocument"===i&&!0===r,h="removeDB"===i&&!0===r,y="removeProperty"===i&&!0===r,p="renameDocument"===i&&!0===r,u="renameProperty"===i&&!0===r;if("print"===i&&!0===n)void 0===l?console.error(`${o} is not defined.`):console.log(l);else if(a){let e=[" ","+","=","-","!","@","#","$","%","^","&","*","(",")","{","[","]","}","|","\\",'"',"'",";",":","?","/",".",">","<",","];const n=n=>{let r=!1;for(let s=0;s<e.length;s++)if(n.includes(e[s])){r=!0;break}return r};if(n(l))throw TypeError("Unallowed letter in the given file name.");try{fs.writeFileSync(`unsafeDb/${l}.json`,JSON.stringify({id:createId(l)}))}catch(e){console.error(e)}}if(c){let e,n=l.split(", ");s[n[0]]?n[0]=s[n[0]]:this.noHandler(),s[n[1]]?n[1]=s[n[1]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}e[n[1]]={},fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}if(f){let e,n=l.split(", ");s[n[0]]?n[0]=s[n[0]]:this.noHandler(),s[n[1]]?n[1]=s[n[1]]:this.noHandler(),s[n[2]]?n[2]=s[n[2]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}const r={};r[n[2]]=n[3],e[n[1]]=r,Object.assign(e[n[1]],r);try{fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}catch(e){console.error(e)}}if(d){let e,n=l.split(", ");s[n[0]]?n[0]=s[n[0]]:this.noHandler(),s[n[1]]?n[1]=s[n[1]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}delete e[n[1]],fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}if(h){let e=l.split(", ");s[e[0]]?e[0]=s[e[0]]:this.noHandler();try{fs.unlinkSync(`unsafeDb/${e[0]}.json`)}catch(e){console.error(e)}}if(y){let e,n=l.split(", ");s[n[0]]?n[0]=s[n[0]]:this.noHandler(),s[n[1]]?n[1]=s[n[1]]:this.noHandler(),s[n[2]]?n[2]=s[n[2]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}delete e[n[1]][n[2]];try{fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}catch(e){console.error(e)}}if(p){let e,n=l.split(", ")||l.split(",");s[n[0]]?n[0]=s[n[0]]:this.noHandler(),s[n[1]]?n[1]=s[n[1]]:this.noHandler(),s[n[2]]?n[2]=s[n[2]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}let r=e[n[1]];delete e[n[1]],e[n[2]]=r;try{fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}catch(e){console.error(e)}}if(u){let e,n=l.split(", ")||l.split(",");s[n[0]]?n[0]=s[n[0]]:this.noHandler(),s[n[1]]?n[1]=s[n[1]]:this.noHandler(),s[n[2]]?n[2]=s[n[2]]:this.noHandler(),s[n[3]]?n[3]=s[n[3]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}let r=e[n[1]][n[2]];delete e[n[1]][n[2]];let t={};t[n[3]]=r,Object.assign(e[n[1]],t);try{fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}catch(e){console.error(e)}}}if(e[t].includes("var",0)){let n=e[t].replace("var","").replace("=","").trim().split("'");s[n[0].trim()]=n[1]}e[t].includes("//",0)&&this.noHandler()}}}module.exports=DLang;
