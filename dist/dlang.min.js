const fs=require("fs"),createId=e=>btoa(e);class DLang{constructor(e){this.lines=e.split("\n")}noHandler(){}run(){let e=this.lines,n=!1,r=!1,t={};for(let s=0;s<e.length;s++){if("import 'dl:main/base.dlang'"===e[s]&&(n=!0),"import 'dl:main/database.dlang'"===e[s]&&(r=!0),e[s].includes("(")){let l,i=e[s].split("(")[0],o=e[s].replace("(","").replace(")","").replace(i,"");l=o.includes("'")?o.replace(/\'/g,""):t[o];let a="createUnsafeDB"===i&&!0===r,c="createDocument"===i&&!0===r,f="createProperty"===i&&!0===r,d="removeDocument"===i&&!0===r,p="removeDB"===i&&!0===r;if("print"===i&&!0===n)void 0===l?console.error(`${o} is not defined.`):console.log(l);else if(a){let e=[" ","+","=","-","!","@","#","$","%","^","&","*","(",")","{","[","]","}","|","\\",'"',"'",";",":","?","/",".",">","<",","];const n=n=>{let r=!1;for(let t=0;t<e.length;t++)if(n.includes(e[t])){r=!0;break}return r};if(n(l))throw TypeError("Unallowed letter in the given file name.");try{fs.writeFileSync(`unsafeDb/${l}.json`,JSON.stringify({id:createId(l)}))}catch(e){console.error(e)}}if(c){let e,n=l.split(", ");t[n[0]]?n[0]=t[n[0]]:this.noHandler(),t[n[1]]?n[1]=t[n[1]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}e[n[1]]={},fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}if(f){let e,n=l.split(", ");t[n[0]]?n[0]=t[n[0]]:this.noHandler(),t[n[1]]?n[1]=t[n[1]]:this.noHandler(),t[n[2]]?n[2]=t[n[2]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}const r={};r[n[2]]=n[3],e[n[1]]=r,Object.assign(e[n[1]],r);try{fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}catch(e){console.error(e)}}if(d){let e,n=l.split(", ");t[n[0]]?n[0]=t[n[0]]:this.noHandler(),t[n[1]]?n[1]=t[n[1]]:this.noHandler();try{e=JSON.parse(fs.readFileSync(`unsafeDb/${n[0]}.json`))}catch(e){console.error(e)}delete e[n[1]],fs.writeFileSync(`unsafeDb/${n[0]}.json`,JSON.stringify(e))}if(p){let e=l.split(", ");t[e[0]]?e[0]=t[e[0]]:this.noHandler();try{fs.unlinkSync(`unsafeDb/${e[0]}.json`)}catch(e){console.error(e)}}}if(e[s].includes("var",0)){let n=e[s].replace("var","").replace("=","").trim().split("'");t[n[0].trim()]=n[1]}e[s].includes("//",0)&&this.noHandler()}}}module.exports=DLang;
